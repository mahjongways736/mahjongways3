<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel - Slot Mahjong</title>
  <style>
    body {
      background: #1a1a1a;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    .container {
      max-width: 600px;
      margin: 40px auto;
      background: #2c2c2c;
      padding: 20px;
      border-radius: 10px;
    }
    input, button, select {
      padding: 10px;
      margin: 5px;
      width: 80%;
      font-size: 16px;
      border-radius: 5px;
      border: none;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
      color: #fff;
    }
    th, td {
      padding: 8px;
      border: 1px solid #555;
    }
    .hidden {
      display: none;
    }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, set, get, update, remove, child, onValue } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";const firebaseConfig = {
  apiKey: "AIzaSyAThDmthe18wYK8uTKS6rdp1V6yGmzSHds",
  authDomain: "slotmahjong-92afb.firebaseapp.com",
  databaseURL: "https://slotmahjong-92afb-default-rtdb.firebaseio.com",
  projectId: "slotmahjong-92afb",
  storageBucket: "slotmahjong-92afb.appspot.com",
  messagingSenderId: "700849730294",
  appId: "1:700849730294:web:17736d11c28b4d381132d7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase();

const adminPassword = "admin123";

window.loginAdmin = function() {
  const pass = document.getElementById("adminPass").value;
  if (pass === adminPassword) {
    document.getElementById("loginPanel").classList.add("hidden");
    document.getElementById("adminPanel").classList.remove("hidden");
    tampilkanData();
  } else {
    document.getElementById("loginMsg").innerText = "Password salah!";
  }
}

async function tampilkanData() {
  const chanceSnap = await get(ref(db, "settings/winChance"));
  const current = chanceSnap.exists() ? chanceSnap.val() : 25;
  document.getElementById("currentChance").innerText = current;

  const playersSnap = await get(ref(db, "players"));
  let html = "<table><tr><th>Nama</th><th>Saldo</th><th>Aksi</th></tr>";

  if (playersSnap.exists()) {
    const players = playersSnap.val();
    for (let nama in players) {
      const saldo = players[nama].saldo || 0;
      html += `<tr>
        <td>${nama}</td>
        <td>Rp${saldo.toLocaleString()}</td>
        <td>
          <button onclick="tambahSaldo('${nama}')">+ Saldo</button>
          <button onclick="editSaldo('${nama}')">Edit</button>
          <button onclick="hapusPlayer('${nama}')">Hapus</button>
          <button onclick="lihatLog('${nama}')">Log</button>
        </td>
      </tr>`;
    }
  }
  html += "</table>";
  document.getElementById("playersList").innerHTML = html;
}

window.ubahPeluang = async function() {
  const baru = parseInt(document.getElementById("newChance").value);
  if (!isNaN(baru) && baru > 0 && baru <= 100) {
    await set(ref(db, "settings/winChance"), baru);
    alert("Peluang menang diubah!");
    tampilkanData();
  }
}

window.tambahSaldo = async function(nama) {
  const jumlahStr = prompt("Tambah saldo berapa?", "10000");
  const jumlah = parseInt(jumlahStr);
  if (!isNaN(jumlah) && jumlah > 0) {
    const saldoRef = ref(db, `players/${nama}/saldo`);
    const snap = await get(saldoRef);
    const saldoLama = snap.exists() ? snap.val() : 0;
    await set(saldoRef, saldoLama + jumlah);
    alert(`Saldo ${nama} berhasil ditambah Rp${jumlah.toLocaleString()}`);
    tampilkanData();
  } else {
    alert("Masukkan jumlah saldo yang valid.");
  }
}

window.editSaldo = async function(nama) {
  const jumlah = prompt("Masukkan saldo baru:", "100000");
  if (jumlah) {
    await set(ref(db, `players/${nama}/saldo`), parseInt(jumlah));
    tampilkanData();
  }
}

window.resetSemuaSaldo = async function() {
  if (confirm("Yakin reset semua saldo ke 100000?")) {
    const snap = await get(ref(db, "players"));
    if (snap.exists()) {
      const updates = {};
      Object.keys(snap.val()).forEach(nama => {
        updates[`players/${nama}/saldo`] = 100000;
      });
      await update(ref(db), updates);
      tampilkanData();
    }
  }
}

window.hapusPlayer = async function(nama) {
  if (confirm("Hapus pemain ini?")) {
    await remove(ref(db, `players/${nama}`));
    tampilkanData();
  }
}

window.lihatLog = async function(nama) {
  const snap = await get(ref(db, `players/${nama}/log`));
  const div = document.getElementById("logSemua");
  if (snap.exists()) {
    const log = snap.val();
    const logs = Object.values(log).map(item => `
      <p>${item.tanggal} - Taruhan: Rp${item.taruhan.toLocaleString()} - ${item.hasil} (Saldo: Rp${item.saldo.toLocaleString()})</p>`).join('');
    div.innerHTML = `<h4>Log: ${nama}</h4>` + logs;
  } else {
    div.innerHTML = `<h4>Log: ${nama}</h4><p>Tidak ada log.</p>`;
  }
}

window.logout = function() {
  location.reload();
}

  </script>
</head>
<body>
  <div class="container" id="loginPanel">
    <h2>Admin Login</h2>
    <input type="password" id="adminPass" placeholder="Password Admin" />
    <button onclick="loginAdmin()">Login</button>
    <p id="loginMsg"></p>
  </div>  <div class="container hidden" id="adminPanel">
    <h2>Admin Panel</h2>
    <p>Peluang Menang Saat Ini: <span id="currentChance"></span>%</p>
    <input type="number" id="newChance" min="1" max="100" placeholder="Ubah peluang menang (1-100)" />
    <button onclick="ubahPeluang()">Update Peluang</button><h3>Daftar Pemain</h3>
<div id="playersList"></div>

<button onclick="resetSemuaSaldo()">Reset Semua Saldo</button>
<button onclick="logout()">Logout</button>

<h3>Log Transaksi Semua Pemain</h3>
<div id="logSemua"></div>

  </div>
</body>
</html>
